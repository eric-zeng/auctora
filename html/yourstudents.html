<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html>
	<head>
		<title>Auctora</title>
		<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
		<link rel="stylesheet" href="../css/questions.css">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/rating.css">
	</head>
  <body>

    <h1>Your Students</h1>
    <ul id="students">
      <!-- students go here -->
    </ul>

    <form action="/studentSearch"> 
      Search Students 
      <input type="submit">
    </form>

    <!-- JAVASCRIPT -->
    <script>
      // TODO: &rated=true

      // Send a GET request to get all the already rated students
      var xmlhttp = new XMLHttpRequest();
      var url = getUrl("nameRequest");
      url += "?rated=true";
      xmlhttp.open("GET", url, true);
      xmlhttp.responseType = "JSON";
      xmlhttp.onload = function(e) {
        var arr = JSON.parse(xmlhttp.response);
        var students = document.getElementById("students");
        
        for (var i = 0; i < arr.length; i++) {
          for (var key in arr) {
            // for each student returned
            // add their name to the list of searchable students
            
            // list item with student name and rating
            var li = document.createElement("li");
            li.id = arr[key]["id"];

            // student image
            var img = document.createElement("img");
            var imgUrl = arr[key]["pictureUrl"];
            img.src = imgUrl;
            li.appendChild(img);

            // student name
            var p = document.createElement("p");
            p.innerHTML = arr[key]["fname"] + " " + arr[key]["lname"];
            li.appendChild(p);
            
            // student rating
            var stars = arr[key]["stars"];
            var div = document.createElement("div");
            div.className = "acidjs-rating-stars";
            div.innerHTML = '<form id="starsForm">' + 
                              '<input type="radio" name="group-1" id="star5" value="5" /><label for="star5"></label>' + 
                              '<input type="radio" name="group-1" id="star4" value="4" /><label for="star4"></label>' + 
                              '<input type="radio" name="group-1" id="star3" value="3" /><label for="star3"></label>' + 
                              '<input type="radio" name="group-1" id="star2" value="2" /><label for="star2"></label>' + 
                              '<input type="radio" name="group-1" id="star1" value="1" /><label for="star1"></label>' + 
                          '</form>';
            li.appendChild(div);

            // document.getElementById("star" + stars).checked = true;

            console.log(li);
            console.log(imgUrl);
            console.log(stars);
            students.appendChild(li);

            document.getElementById("star" + stars).checked = true;
          }
        }
      }
      xmlhttp.send();

      // Helper function to determine if we're running on localhost or production web server
      function getUrl(nextPage) {
        var url = window.location.protocol + "//" + window.location.hostname;
        if (window.location.hostname == "localhost") {
          url += ":" + window.location.port;
        }
        url += "/" + nextPage;
        return url;
      }
    </script>
  </body>

</html>